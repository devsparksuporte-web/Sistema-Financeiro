{% extends "base.html" %}

{% block title %}Gestão Financeira{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-2">
                <i class="fas fa-file-invoice-dollar text-primary me-2"></i> Gestão Financeira
            </h1>
            <p class="text-muted">Gestão completa de despesas, receitas e controle orçamentário</p>
        </div>
        <div class="col-auto">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="novaTransacao('despesa')">
                    <i class="fas fa-plus me-1"></i> Nova Despesa
                </button>
                <button class="btn btn-success" onclick="novaTransacao('receita')">
                    <i class="fas fa-plus me-1"></i> Nova Receita
                </button>
            </div>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Categoria</label>
                            <select id="filtroCategoria" class="form-select" onchange="filtrarTransacoes()">
                                <option value="todas">Todas as Categorias</option>
                                <option value="fixas">Despesas Fixas</option>
                                <option value="pessoal">Pessoal</option>
                                <option value="operacionais">Operacionais</option>
                                <option value="vendas">Vendas</option>
                                <option value="investimentos">Investimentos</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Status</label>
                            <select id="filtroStatus" class="form-select" onchange="filtrarTransacoes()">
                                <option value="todas">Todos Status</option>
                                <option value="pago">Pago</option>
                                <option value="pendente">Pendente</option>
                                <option value="atrasado">Atrasado</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Período</label>
                            <select id="filtroPeriodo" class="form-select" onchange="filtrarTransacoes()">
                                <option value="este_mes">Este Mês</option>
                                <option value="mes_anterior">Mês Anterior</option>
                                <option value="este_trimestre">Este Trimestre</option>
                                <option value="este_ano">Este Ano</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Buscar</label>
                            <div class="input-group">
                                <input type="text" id="buscaDespesa" class="form-control" 
                                       placeholder="Descrição, fornecedor..." oninput="filtrarTransacoes()">
                                <button class="btn btn-outline-secondary" type="button" onclick="filtrarTransacoes()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estatísticas -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-primary shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="text-muted mb-1">Despesas Totais</h6>
                            <h3 class="mb-0" id="totalDespesas">R$ 0,00</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-money-bill fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-success shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="text-muted mb-1">Receitas Totais</h6>
                            <h3 class="mb-0" id="totalReceitas">R$ 0,00</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-chart-line fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-info shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="text-muted mb-1">Saldo Mensal</h6>
                            <h3 class="mb-0" id="saldoMensal">R$ 0,00</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-balance-scale fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-warning shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="text-muted mb-1">Ponto de Equilíbrio</h6>
                            <h3 class="mb-0" id="pontoEquilibrio">R$ 0,00</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-bullseye fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tabela de Despesas -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold">
                        <i class="fas fa-list me-1"></i> Registros Financeiros
                    </h6>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-secondary" onclick="exportarTransacoes('excel')">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="exportarTransacoes('pdf')">
                            <i class="fas fa-file-pdf me-1"></i> PDF
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="exportarTransacoes('csv')">
                            <i class="fas fa-file-csv me-1"></i> CSV
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Data</th>
                                    <th>Descrição</th>
                                    <th>Categoria</th>
                                    <th>Fornecedor</th>
                                    <th>Valor (R$)</th>
                                    <th>Status</th>
                                    <th>Vencimento</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="despesasTable">
                                <!-- Despesas serão carregadas aqui -->
                                <tr>
                                    <td colspan="8" class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Carregando...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-0 small text-muted">
                                Total: <span id="totalRegistros">0</span> registros • 
                                Valor: <span id="totalValor">R$ 0,00</span>
                            </p>
                        </div>
                        <div class="col-md-6 text-end">
                            <nav aria-label="Navegação de páginas">
                                <ul class="pagination pagination-sm justify-content-end mb-0" id="paginacao">
                                    <!-- Paginação será gerada aqui -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Nova Despesa -->
<div class="modal fade" id="modalTransacao" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Nova Transação</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formTransacao">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Descrição *</label>
                            <input type="text" class="form-control" name="descricao" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Valor (R$) *</label>
                            <input type="number" class="form-control" name="valor" step="0.01" min="0" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Data *</label>
                            <input type="date" class="form-control" name="data" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Data de Vencimento</label>
                            <input type="date" class="form-control" name="data_vencimento">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Categoria *</label>
                            <select class="form-select" name="categoria" required>
                                <option value="">Selecione...</option>
                                <option value="fixas">Despesas Fixas</option>
                                <option value="pessoal">Pessoal</option>
                                <option value="operacionais">Operacionais</option>
                                <option value="vendas">Vendas</option>
                                <option value="investimentos">Investimentos</option>
                                <option value="outras">Outras</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="pendente">Pendente</option>
                                <option value="pago">Pago</option>
                                <option value="atrasado">Atrasado</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Fornecedor</label>
                            <input type="text" class="form-control" name="fornecedor">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Forma de Pagamento</label>
                            <input type="text" class="form-control" name="forma_pagamento" 
                                   placeholder="Ex: Cartão, Boleto, Transferência">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Observações</label>
                            <textarea class="form-control" name="observacoes" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="salvarTransacao()">Salvar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Variáveis
let despesas = [];
let paginaAtual = 1;
const itensPorPagina = 20;

// Formatar moeda
function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
    }).format(value);
}

// Formatar data
function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-BR');
}

// Carregar despesas
async function carregarTransacoes() {
    try {
        // Coletar filtros
        const categoria = document.getElementById('filtroCategoria').value;
        const status = document.getElementById('filtroStatus').value;
        const periodo = document.getElementById('filtroPeriodo').value;
        const busca = document.getElementById('buscaDespesa').value;
        
        // Construir query string
        let query = `?pagina=${paginaAtual}&limite=${itensPorPagina}`;
        
        if (categoria && categoria !== 'todas') {
            query += `&categoria=${categoria}`;
        }
        
        if (status && status !== 'todas') {
            query += `&status=${status}`;
        }
        
        if (busca) {
            query += `&busca=${encodeURIComponent(busca)}`;
        }
        
        // Adicionar período
        const hoje = new Date();
        let dataInicio, dataFim;
        
        switch(periodo) {
            case 'mes_anterior':
                const primeiroDiaMesPassado = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
                const ultimoDiaMesPassado = new Date(hoje.getFullYear(), hoje.getMonth(), 0);
                dataInicio = primeiroDiaMesPassado.toISOString().split('T')[0];
                dataFim = ultimoDiaMesPassado.toISOString().split('T')[0];
                break;
            case 'este_trimestre':
                const trimestre = Math.floor(hoje.getMonth() / 3);
                const mesInicioTrimestre = trimestre * 3;
                dataInicio = new Date(hoje.getFullYear(), mesInicioTrimestre, 1).toISOString().split('T')[0];
                dataFim = hoje.toISOString().split('T')[0];
                break;
            case 'este_ano':
                dataInicio = new Date(hoje.getFullYear(), 0, 1).toISOString().split('T')[0];
                dataFim = hoje.toISOString().split('T')[0];
                break;
            default: // este_mes
                const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                dataInicio = primeiroDiaMes.toISOString().split('T')[0];
                dataFim = hoje.toISOString().split('T')[0];
        }
        
        query += `&data_inicio=${dataInicio}&data_fim=${dataFim}`;
        
        const response = await fetch(`/api/transacoes${query}`);
        const data = await response.json();
        
        if (data.success) {
            despesas = data.despesas;
            atualizarTabelaDespesas();
            atualizarEstatisticas(data.estatisticas);
            atualizarPaginacao(data.total, data.paginas);
        } else {
            throw new Error(data.message);
        }
        
    } catch (error) {
        console.error('Erro ao carregar despesas:', error);
        mostrarToast('Erro ao carregar despesas', 'error');
    }
}

// Atualizar tabela de despesas
function atualizarTabelaDespesas() {
    const tbody = document.getElementById('despesasTable');
    
    if (despesas.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" class="text-center py-4">
                    <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                    <p class="text-muted">Nenhuma despesa encontrada</p>
                </td>
            </tr>
        `;
        return;
    }
    
    let html = '';
    
    despesas.forEach(despesa => {
        // Status badge
        let statusBadge = '';
        switch(despesa.status) {
            case 'pago':
                statusBadge = '<span class="badge bg-success">Pago</span>';
                break;
            case 'pendente':
                statusBadge = '<span class="badge bg-warning">Pendente</span>';
                break;
            case 'atrasado':
                statusBadge = '<span class="badge bg-danger">Atrasado</span>';
                break;
            default:
                statusBadge = `<span class="badge bg-secondary">${despesa.status}</span>`;
        }
        
        // Categoria badge
        const categorias = {
            'fixas': 'primary',
            'pessoal': 'success',
            'operacionais': 'warning',
            'vendas': 'danger',
            'investimentos': 'info',
            'outras': 'secondary'
        };
        
        const categoriaNome = {
            'fixas': 'Fixas',
            'pessoal': 'Pessoal',
            'operacionais': 'Operacionais',
            'vendas': 'Vendas',
            'investimentos': 'Investimentos',
            'outras': 'Outras'
        };
        
        const categoriaBadge = `<span class="badge bg-${categorias[despesa.categoria] || 'secondary'}">
            ${categoriaNome[despesa.categoria] || despesa.categoria}
        </span>`;
        
        html += `
        <tr>
            <td>${formatDate(despesa.data)}</td>
            <td>
                <div class="fw-bold">${despesa.descricao}</div>
                ${despesa.observacoes ? `<small class="text-muted">${despesa.observacoes}</small>` : ''}
            </td>
            <td>${categoriaBadge}</td>
            <td>${despesa.fornecedor || '-'}</td>
            <td class="fw-bold">${formatCurrency(despesa.valor)}</td>
            <td>${statusBadge}</td>
            <td>${despesa.data_vencimento ? formatDate(despesa.data_vencimento) : '-'}</td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="editarTransacao(${despesa.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger" onclick="excluirTransacao(${despesa.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
        `;
    });
    
    tbody.innerHTML = html;
}

// Atualizar estatísticas
function atualizarEstatisticas(estatisticas) {
    document.getElementById('totalDespesas').textContent = formatCurrency(estatisticas.total);
    document.getElementById('totalReceitas').textContent = formatCurrency(estatisticas.receitas || 0);
    document.getElementById('saldoMensal').textContent = formatCurrency((estatisticas.receitas || 0) - estatisticas.total);
    document.getElementById('pontoEquilibrio').textContent = formatCurrency(estatisticas.total * 1.3); // Simulação
    
    document.getElementById('totalRegistros').textContent = estatisticas.quantidade;
    document.getElementById('totalValor').textContent = formatCurrency(estatisticas.total);
}

// Atualizar paginação
function atualizarPaginacao(total, totalPaginas) {
    const paginacao = document.getElementById('paginacao');
    
    if (totalPaginas <= 1) {
        paginacao.innerHTML = '';
        return;
    }
    
    let html = '';
    
    // Botão anterior
    html += `
    <li class="page-item ${paginaAtual === 1 ? 'disabled' : ''}">
        <button class="page-link" onclick="mudarPagina(${paginaAtual - 1})">
            <i class="fas fa-chevron-left"></i>
        </button>
    </li>
    `;
    
    // Números das páginas
    const maxBotoes = 5;
    let inicio = Math.max(1, paginaAtual - Math.floor(maxBotoes / 2));
    let fim = Math.min(totalPaginas, inicio + maxBotoes - 1);
    
    if (fim - inicio + 1 < maxBotoes) {
        inicio = Math.max(1, fim - maxBotoes + 1);
    }
    
    for (let i = inicio; i <= fim; i++) {
        html += `
        <li class="page-item ${i === paginaAtual ? 'active' : ''}">
            <button class="page-link" onclick="mudarPagina(${i})">${i}</button>
        </li>
        `;
    }
    
    // Botão próximo
    html += `
    <li class="page-item ${paginaAtual === totalPaginas ? 'disabled' : ''}">
        <button class="page-link" onclick="mudarPagina(${paginaAtual + 1})">
            <i class="fas fa-chevron-right"></i>
        </button>
    </li>
    `;
    
    paginacao.innerHTML = html;
}

// Mudar página
function mudarPagina(pagina) {
    if (pagina < 1) return;
    paginaAtual = pagina;
    carregarTransacoes();
}

// Filtrar despesas
function filtrarTransacoes() {
    paginaAtual = 1;
    carregarTransacoes();
}

// Nova despesa
function novaTransacao(tipo = 'despesa') {
    const form = document.getElementById('formTransacao');
    form.reset();
    form.dataset.id = '';
    
    // Adicionar campo oculto para o tipo
    let tipoInput = document.getElementById('tipoTransacao');
    if (!tipoInput) {
        tipoInput = document.createElement('input');
        tipoInput.type = 'hidden';
        tipoInput.id = 'tipoTransacao';
        tipoInput.name = 'tipo';
        form.appendChild(tipoInput);
    }
    tipoInput.value = tipo;
    
    // Atualizar título do modal
    document.getElementById('modalTitle').textContent = tipo === 'despesa' ? 'Nova Despesa' : 'Nova Receita';
    
    // Preencher data atual
    const hoje = new Date().toISOString().split('T')[0];
    form.querySelector('[name="data"]').value = hoje;
    
    const modal = new bootstrap.Modal(document.getElementById('modalTransacao'));
    modal.show();
}

// Editar transação
async function editarTransacao(id) {
    try {
        const response = await fetch(`/api/transacoes/${id}`);
        const data = await response.json();
        
        if (data.success && data.transacao) {
            const transacao = data.transacao;
            const form = document.getElementById('formTransacao');  // ← CORRETO
            
            if (!form) {
                mostrarToast('Formulário não encontrado', 'error');
                return;
            }
            
            // Preencher formulário
            const campos = {
                'descricao': transacao.descricao,
                'valor': transacao.valor,
                'data': transacao.data ? transacao.data.split('T')[0] : '',
                'data_vencimento': transacao.data_vencimento ? transacao.data_vencimento.split('T')[0] : '',
                'categoria': transacao.categoria,
                'status': transacao.status,
                'fornecedor': transacao.fornecedor || '',
                'forma_pagamento': transacao.forma_pagamento || '',
                'observacoes': transacao.observacoes || ''
            };
            
            Object.keys(campos).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input) {
                    input.value = campos[key];
                }
            });
            
            form.dataset.id = id;
            
            const modal = new bootstrap.Modal(document.getElementById('modalTransacao'));  // ← CORRETO
            modal.show();
        } else {
            throw new Error('Transação não encontrada');
        }
    } catch (error) {
        console.error('Erro ao carregar transação:', error);
        mostrarToast(error.message || 'Erro ao carregar transação', 'error');
    }
}

// Salvar transação
async function salvarTransacao() {
    try {
        const form = document.getElementById('formTransacao');  // ← CORRETO
        if (!form) {
            mostrarToast('Formulário não encontrado', 'error');
            return;
        }
        
        // Coletar dados manualmente
        const dados = {
            descricao: form.querySelector('[name="descricao"]').value,
            valor: parseFloat(form.querySelector('[name="valor"]').value.replace(',', '.')),
            data: form.querySelector('[name="data"]').value,
            data_vencimento: form.querySelector('[name="data_vencimento"]').value || null,
            categoria: form.querySelector('[name="categoria"]').value,
            tipo: document.getElementById('tipoTransacao') ? document.getElementById('tipoTransacao').value : 'despesa',
            status: form.querySelector('[name="status"]').value,
            fornecedor: form.querySelector('[name="fornecedor"]').value || '',
            forma_pagamento: form.querySelector('[name="forma_pagamento"]').value || '',
            observacoes: form.querySelector('[name="observacoes"]').value || ''
        };
        
        const id = form.dataset.id || '';
        const url = id ? `/api/transacoes/${id}` : '/api/transacoes';
        const method = id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        });
        
        const data = await response.json();
        
        if (data.success) {
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalTransacao'));
            if (modal) modal.hide();
            
            mostrarToast(data.message, 'success');
            carregarTransacoes();
        } else {
            throw new Error(data.message);
        }
    } catch (error) {
        console.error('Erro ao salvar transação:', error);
        mostrarToast(error.message || 'Erro ao salvar transação', 'error');
    }
}

// Excluir despesa
async function excluirTransacao(id) {
    if (!confirm('Tem certeza que deseja excluir esta despesa?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/transacoes/${id}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            mostrarToast('Despesa excluída com sucesso', 'success');
            carregarTransacoes();
        } else {
            throw new Error(data.message);
        }
    } catch (error) {
        console.error('Erro ao excluir despesa:', error);
        mostrarToast(error.message || 'Erro ao excluir despesa', 'error');
    }
}



// Exportar despesas
async function exportarTransacoes(formato) {
    try {
        // Coletar filtros atuais
        const categoria = document.getElementById('filtroCategoria').value;
        const status = document.getElementById('filtroStatus').value;
        const periodo = document.getElementById('filtroPeriodo').value;
        const busca = document.getElementById('buscaDespesa').value;
        
        let query = `?formato=${formato}`;
        
        if (categoria && categoria !== 'todas') {
            query += `&categoria=${categoria}`;
        }
        
        if (status && status !== 'todas') {
            query += `&status=${status}`;
        }
        
        if (busca) {
            query += `&busca=${encodeURIComponent(busca)}`;
        }
        
        window.open(`/api/transacoes/exportar/${formato}${query}`, '_blank');
        
    } catch (error) {
        console.error('Erro ao exportar:', error);
        mostrarToast('Erro ao exportar despesas', 'error');
    }
}

// Mostrar toast (Usando a função global showToast de base.html)
function mostrarToast(mensagem, tipo = 'info') {
    showToast(mensagem, tipo);
}

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
    carregarTransacoes();
    
    // Normalizar campo de valor (aceitar vírgula e converter para ponto)
    const campoValor = document.querySelector('input[name="valor"]');
    if (campoValor) {
        campoValor.addEventListener('blur', function() {
            // Substituir vírgula por ponto
            this.value = this.value.replace(',', '.');
        });
        
        // Também normalizar ao digitar
        campoValor.addEventListener('input', function() {
            // Permitir apenas números, ponto e vírgula
            this.value = this.value.replace(/[^0-9.,]/g, '');
        });
    }
    
    // Atalhos de teclado
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'n') {
            e.preventDefault();
            novaTransacao();
        } else if (e.ctrlKey && e.key === 'e') {
            e.preventDefault();
            exportarTransacoes('excel');
        } else if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('buscaDespesa').focus();
        }
    });
});
</script>

{% endblock %}
